---
- name: Create and upload one or multiple VPN clients
  hosts: vpn
  gather_facts: false
  vars:
    vpn_action: "create"

  pre_tasks:
    - name: Ensure client_names are provided
      fail:
        msg: "client_names must be passed using -e"
      when: client_names is not defined or client_names | length == 0

  tasks:
    - name: Create/upload for each client
      include_role:
        name: vpn_cert
      vars:
        client_name: "{{ item }}"
        vpn_action: "create"
      loop: "{{ client_names }}"